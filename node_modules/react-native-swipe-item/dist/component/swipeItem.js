Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _jsxFileName='src/component/swipeItem.js';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _swipeButtonsContainer=require('./swipeButtonsContainer');var _swipeButtonsContainer2=_interopRequireDefault(_swipeButtonsContainer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var SwipeItem=function(_React$Component){_inherits(SwipeItem,_React$Component);function SwipeItem(props){_classCallCheck(this,SwipeItem);var _this=_possibleConstructorReturn(this,(SwipeItem.__proto__||Object.getPrototypeOf(SwipeItem)).call(this,props));_this._swipeItem=_this;_this._panDistanceOffset={x:0,y:0};_this._isRightButtonShowing=false;_this._isLeftButtonShowing=false;_this.state={panDistance:new _reactNative.Animated.ValueXY(),rightButtonTriggerPosition:0,leftButtonTriggerPosition:0};_this._panResponder=_this._createPanResponderInstance();_this.state.panDistance.addListener(function(value){_this._panDistanceOffset=value;});return _this;}_createClass(SwipeItem,[{key:'componentWillUnmount',value:function componentWillUnmount(){this.state.panDistance.removeAllListeners();}},{key:'_createPanResponderInstance',value:function _createPanResponderInstance(){var _this2=this;var instance=_reactNative.PanResponder.create({onMoveShouldSetPanResponderCapture:function onMoveShouldSetPanResponderCapture(evt,gestureState){if(Math.abs(gestureState.dx)<5){return false;}if(_this2.props.disableSwipeIfNoButton){if(!_this2.props.leftButtons&&gestureState.dx>0&&!_this2._isRightButtonShowing||!_this2.props.rightButtons&&gestureState.dx<0&&!_this2._isLeftButtonShowing){return false;}}var offsetX=_this2._panDistanceOffset.x;if(Math.round(offsetX)===0){_this2.props.onSwipeInitial&&_this2.props.onSwipeInitial(_this2._swipeItem);}return true;},onPanResponderGrant:function onPanResponderGrant(evt,gestureState){_this2.state.panDistance.setOffset(_this2._panDistanceOffset);_this2.state.panDistance.setValue({x:0,y:0});},onPanResponderMove:_reactNative.Animated.event([null,{dx:this.state.panDistance.x}]),onPanResponderRelease:function onPanResponderRelease(evt,gestureState){_this2._moveToDestination(_this2._getSwipePositionDestinationValueX(gestureState.dx));},onPanResponderTerminate:function onPanResponderTerminate(evt,gestureState){_this2._moveToDestination(_this2._getSwipePositionDestinationValueX(gestureState.dx));return true;},onPanResponderTerminationRequest:function onPanResponderTerminationRequest(evt,gestureState){if(_reactNative.Platform.OS==='android'){return true;}return false;}});return instance;}},{key:'_moveToDestination',value:function _moveToDestination(toX){if(Math.round(toX)===0){this._isLeftButtonShowing=false;this._isRightButtonShowing=false;this.props.onMovedToOrigin&&this.props.onMovedToOrigin(this._swipeItem);}this.state.panDistance.flattenOffset();_reactNative.Animated.spring(this.state.panDistance,{toValue:{x:toX,y:0},friction:10}).start();}},{key:'close',value:function close(){this._moveToDestination(0);}},{key:'_getSwipePositionDestinationValueX',value:function _getSwipePositionDestinationValueX(panDistanceX){var _state=this.state,leftButtonTriggerPosition=_state.leftButtonTriggerPosition,rightButtonTriggerPosition=_state.rightButtonTriggerPosition;var toValueX=0;var panSide=panDistanceX>0?'right':'left';var containerOffset=this._panDistanceOffset.x;if(panSide==='right'&&containerOffset>leftButtonTriggerPosition){toValueX=leftButtonTriggerPosition;this._isLeftButtonShowing=true;this.props.onLeftButtonsShowed&&this.props.onLeftButtonsShowed(this._swipeItem);}if(panSide==='left'&&containerOffset<rightButtonTriggerPosition){toValueX=rightButtonTriggerPosition;this._isRightButtonShowing=true;this.props.onRightButtonsShowed&&this.props.onRightButtonsShowed(this._swipeItem);}return toValueX;}},{key:'_renderleftButtonsIfNotNull',value:function _renderleftButtonsIfNotNull(){var _this3=this;var _props$leftButtons=this.props.leftButtons,leftButtons=_props$leftButtons===undefined?null:_props$leftButtons;var leftButtonTriggerPosition=this.state.leftButtonTriggerPosition;if(leftButtons==null){return null;}var _leftButtons$props=leftButtons.props,style=_leftButtons$props.style,children=_leftButtons$props.children;var scale=this.state.panDistance.x.interpolate({inputRange:[-Infinity,-0.01,0,leftButtonTriggerPosition,Infinity],outputRange:[0.01,0.01,0.7,1,1]});var widthStyle={transform:[{scale:scale}]};return _react2.default.createElement(_swipeButtonsContainer2.default,{style:[style,buttonViewStyles.container,buttonViewStyles.left,widthStyle],onLayout:function onLayout(_ref){var nativeEvent=_ref.nativeEvent;_this3.setState({leftButtonTriggerPosition:nativeEvent.layout.width});},__source:{fileName:_jsxFileName,lineNumber:205}},children);}},{key:'_renderrightButtonsIfNotNull',value:function _renderrightButtonsIfNotNull(){var _this4=this;var _props$rightButtons=this.props.rightButtons,rightButtons=_props$rightButtons===undefined?null:_props$rightButtons;var rightButtonTriggerPosition=this.state.rightButtonTriggerPosition;if(rightButtons==null){return null;}var _rightButtons$props=rightButtons.props,style=_rightButtons$props.style,children=_rightButtons$props.children;var scale=this.state.panDistance.x.interpolate({inputRange:[-Infinity,rightButtonTriggerPosition,0,0.1,Infinity],outputRange:[1,1,0.7,0.01,0.01]});var widthStyle={transform:[{scale:scale}]};return _react2.default.createElement(_swipeButtonsContainer2.default,{style:[style,buttonViewStyles.container,buttonViewStyles.right,widthStyle],onLayout:function onLayout(_ref2){var nativeEvent=_ref2.nativeEvent;_this4.setState({rightButtonTriggerPosition:-1*nativeEvent.layout.width});},__source:{fileName:_jsxFileName,lineNumber:246}},children);}},{key:'render',value:function render(){var panStyle={transform:this.state.panDistance.getTranslateTransform()};var _props=this.props,style=_props.style,swipeContainerStyle=_props.swipeContainerStyle,_props$containerView=_props.containerView,ContainerView=_props$containerView===undefined?_reactNative.View:_props$containerView;return _react2.default.createElement(_reactNative.View,{__source:{fileName:_jsxFileName,lineNumber:271}},_react2.default.createElement(ContainerView,{style:[style,containerStyles.rootContainer],__source:{fileName:_jsxFileName,lineNumber:272}},_react2.default.createElement(_reactNative.View,{style:[containerStyles.buttonsContainer],__source:{fileName:_jsxFileName,lineNumber:278}},this._renderleftButtonsIfNotNull(),this._renderrightButtonsIfNotNull()),_react2.default.createElement(_reactNative.Animated.View,_extends({style:[containerStyles.swipeContainer,panStyle]},this._panResponder.panHandlers,{__source:{fileName:_jsxFileName,lineNumber:284}}),_react2.default.createElement(_reactNative.View,{style:[swipeContainerStyle,containerStyles.swipeContainer],__source:{fileName:_jsxFileName,lineNumber:288}},this.props.children))));}}]);return SwipeItem;}(_react2.default.Component);exports.default=SwipeItem;var containerStyles=_reactNative.StyleSheet.create({rootContainer:{flexDirection:'row',justifyContent:'center'},buttonsContainer:{height:'100%',width:'100%',position:'absolute',flexDirection:'row',top:0,left:0},swipeContainer:{height:'100%',width:'100%'}});var buttonViewStyles=_reactNative.StyleSheet.create({container:{position:'absolute'},left:{left:0},right:{right:0}});